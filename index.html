<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ˜Ÿè¾° SQL æ”¹é€ å·¥å…·</title>
  <link rel="icon" href="image/icon.ico" type="images/x-ico" />
  <style>
    :root {
      --primary-color: #2c3e50;
      --accent-color: #3498db;
      --background-color: #f8f9fa;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      line-height: 1.6;
      padding: 2rem;
      max-width: 1000px;
      margin: 0 auto;
      background-color: var(--background-color);
      color: var(--primary-color);
    }

    h2 {
      color: var(--accent-color);
      border-bottom: 2px solid;
      padding-bottom: 0.5em;
    }

    textarea {
      width: 100%;
      height: 200px;
      margin: 1rem 0;
      padding: 0.8rem;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-family: 'Consolas', monospace;
      transition: border-color 0.3s ease;
      resize: vertical;
    }

    textarea:focus {
      border-color: var(--accent-color);
      outline: none;
    }

    .button-group {
      margin: 1rem 0;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    button {
      padding: 0.8rem 1.5rem;
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }

    button:hover {
      opacity: 0.9;
    }

    button:active {
      transform: scale(0.98);
    }

    nav {
      margin-bottom: 1.5rem;
    }

    nav button {
      background-color: #ddd;
      color: #333;
      margin-right: 0.3rem;
    }

    nav button.active {
      background-color: var(--accent-color);
      color: white;
    }

    section {
      display: none;
    }

    section.active {
      display: block;
    }
  </style>
</head>
<body>

<h2>ğŸŒŸ æ˜Ÿè¾° SQL æ”¹é€ å·¥å…·</h2>

<nav>
  <button id="mode1" class="active">åŠŸèƒ½ 1ï¼šå»ºè¡¨/ç´¢å¼• æ”¹é€ </button>
  <button id="mode2">åŠŸèƒ½ 2ï¼šæ–°å¢å­—æ®µ ALTER SQL</button>
</nav>

<!-- åŠŸèƒ½ 1 -->
<section id="section1" class="active">
  <textarea id="input1" placeholder="ç²˜è´´åŸå§‹ SQL..."></textarea>
  <div class="button-group">
    <button onclick="transformSQL()">ğŸš€ æ”¹é€  SQL</button>
    <button onclick="copyOutput('output1')">ğŸ“„ å¤åˆ¶ç»“æœ</button>
  </div>
  <div style="display: flex; justify-content: space-between; align-items: center;">
<!--    <h3 style="margin: 0;">ğŸ“‹ æ”¹é€ ç»“æœ</h3>-->
<!--    <button id="copyBtn" onclick="copyOutput('output1')">ğŸ“„ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>-->
  </div>
  <textarea id="output1" placeholder="æ”¹é€ åçš„ SQL..." readonly></textarea>
</section>

<!-- åŠŸèƒ½ 2 -->
<section id="section2">
  <input type="text" id="tableName" placeholder=" è¯·è¾“å…¥è¡¨å..." style="width: 100%; padding: 10px; font-size: 15px; border: 2px solid #ddd; border-radius: 5px;">
  <textarea id="fieldInput" placeholder="å¤šä¸ªå­—æ®µç”¨è‹±æ–‡é€—å· , åˆ†éš”ï¼ˆä¾‹ï¼šfk_id int8 NULL, fk_name citext NOT NULL DEFAULT 'xx'ï¼‰"></textarea>

  <div class="button-group">
    <button onclick="generateAlterSQL()">âœ¨ ç”Ÿæˆ ALTER SQL</button>
    <button onclick="copyOutput('alterOutput')">ğŸ“„ å¤åˆ¶ç»“æœ</button>
  </div>
<!--   <h3 style="margin: 0;">ğŸ“‹ æ”¹é€ ç»“æœ</h3> -->
  <textarea id="alterOutput" placeholder="ç”Ÿæˆçš„ ALTER SQL..." readonly></textarea>
</section>

<script>
  // åˆ‡æ¢åŠŸèƒ½æ¨¡å—
  document.getElementById('mode1').addEventListener('click', () => {
    setMode(1);
  });
  document.getElementById('mode2').addEventListener('click', () => {
    setMode(2);
  });

  function setMode(mode) {
    document.getElementById('mode1').classList.remove('active');
    document.getElementById('mode2').classList.remove('active');
    document.getElementById('section1').classList.remove('active');
    document.getElementById('section2').classList.remove('active');

    document.getElementById(`mode${mode}`).classList.add('active');
    document.getElementById(`section${mode}`).classList.add('active');
  }

  function transformSQL() {
    const input = document.getElementById('input1').value.trim();
    if (!input) {
      alert('âš ï¸ è¯·ç²˜è´´åŸå§‹ SQL');
      return;
    }
    const statements = input.split(/;\s*\n?/).filter(s => s.trim());
    const dialectTag = '/#dialect-simple#/';
    const output = [];

    statements.forEach(stmt => {
      const s = stmt.trim();
      const lower = s.toLowerCase();
      let res = '';

      if (lower.startsWith('create table')) {
        res = s.replace(/create table\s+(\w+)/i, 'CREATE TABLE IF NOT EXISTS #SCHEMANAME#.$1');
      } else if (lower.startsWith('alter table')) {
        res = s.replace(/alter table\s+(\w+)/i, 'ALTER TABLE IF EXISTS ONLY #SCHEMANAME#.$1')
                .replace(/add constraint/i, 'ADD CONSTRAINT');
      } else if (lower.startsWith('insert into')) {
        const match = s.match(/into\s+(\w+)\s*\(([^)]+)\)\s*values\s*\(([^)]+)\)/i);
        if (match) {
          const table = match[1];
          const cols = match[2].split(',').map(c => c.trim().toLowerCase());
          const vals = match[3].split(',');
          const fidIdx = cols.indexOf('fid');
          if (fidIdx !== -1 && vals[fidIdx]) {
            output.push(`${dialectTag}\nDELETE FROM #SCHEMANAME#.${table} WHERE fid = ${vals[fidIdx].trim()};`);
          }
        }
        res = s.replace(/insert into\s+(\w+)/i, 'INSERT INTO #SCHEMANAME#.$1');
      } else if (lower.startsWith('create index')) {
        res = s.replace(/create index\s+/i, 'CREATE INDEX IF NOT EXISTS ')
                .replace(/on\s+(\w+)/i, 'ON #SCHEMANAME#.$1');
      }

      if (res) output.push(`${dialectTag}\n${res};`);
    });

    document.getElementById('output1').value = output.join('\n\n');
  }

  function generateAlterSQL() {
    const tableName = document.getElementById('tableName').value.trim();
    const rawFields = document.getElementById('fieldInput').value.trim();
    if (!tableName || !rawFields) {
      alert('âš ï¸ è¯·å¡«å†™è¡¨åå’Œå­—æ®µå®šä¹‰');
      return;
    }

    const dialectTag = '/#dialect-simple#/';
    const fields = rawFields.split(',').map(f => f.trim()).filter(f => f);
    const sqls = fields.map(f =>
            `${dialectTag}\nALTER TABLE IF EXISTS ONLY #SCHEMANAME#.${tableName} \nADD COLUMN IF NOT EXISTS ${f};`
    );

    document.getElementById('alterOutput').value = sqls.join('\n\n');
  }

  function copyOutput(id) {
    const target = document.getElementById(id);
    if (!target.value.trim()) {
      alert('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶');
      return;
    }

    navigator.clipboard.writeText(target.value).then(() => {
      alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    }).catch(() => {
      target.select();
      document.execCommand('copy');
      alert('âœ… å·²å¤åˆ¶ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰');
    });
  }
</script>
</body>
</html>
